<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
    <meta name="theme-color" content="#000000" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <title>Codex Chat Remote</title>
    <link rel="manifest" href="./manifest.webmanifest" />
    <link rel="stylesheet" href="./styles.css?v=20260228a" />
  </head>
  <body>
    <header class="topbar">
      <div class="title-wrap">
        <h1>Codex Chat Remote</h1>
        <p class="subtitle">Control your local Codex Chat session securely.</p>
      </div>
      <button id="accountButton" class="connection-button" type="button" aria-label="Open account and connection controls">
        <span id="connectionBadge" class="badge">Disconnected</span>
      </button>
    </header>

    <main class="app-main">
      <section id="preConnectPanel" class="preconnect-view" hidden>
        <section class="panel preconnect-card" aria-labelledby="preconnectTitle">
          <h2 id="preconnectTitle">Pair to continue</h2>
          <p>Projects and chats appear after desktop approves pairing and this device connects.</p>
          <button id="preconnectPairButton" class="primary" type="button">Pair Device</button>
          <section id="welcomePanel" class="welcome-card" hidden>
            <h3>Welcome from QR</h3>
            <p>For best reliability, add this app to your home screen before pairing.</p>
            <ol class="welcome-steps">
              <li>Install to home screen.</li>
              <li>Tap <strong>Pair Device</strong> and approve on your Mac.</li>
              <li>This device reconnects automatically until revoked from desktop.</li>
            </ol>
            <div class="welcome-actions">
              <button id="installButton" class="primary" type="button" hidden>Add to Home Screen</button>
              <button id="dismissWelcomeButton" type="button">Continue in Browser</button>
            </div>
            <p id="installHint" class="install-hint" hidden></p>
          </section>
        </section>
      </section>

      <section id="workspacePanel" class="workspace" hidden>
        <section id="homeView" class="home-view" aria-label="Chat home">
          <section class="panel projects-panel" aria-labelledby="projectsHeading">
            <div class="section-head">
              <h2 id="projectsHeading">Projects</h2>
              <button id="viewAllProjectsButton" class="ghost" type="button">View all</button>
            </div>
            <div id="projectCircleStrip" class="project-strip" role="list" aria-label="Projects"></div>
          </section>

          <section class="panel chats-panel" aria-labelledby="chatsHeading">
            <h2 id="chatsHeading">Chats</h2>
            <div id="chatListEmpty" class="empty-state" hidden>No chats yet</div>
            <ul id="chatList" class="chat-list" aria-label="Chats"></ul>
          </section>
        </section>

        <section id="chatView" class="chat-view" aria-label="Chat detail" hidden>
          <div class="chat-topbar">
            <button id="chatBackButton" class="ghost back-button" type="button" aria-label="Back to chats">Back</button>
            <h2 id="threadTitle">Thread</h2>
            <span id="threadStatusChip" class="thread-status" hidden>Running</span>
          </div>

          <section class="panel approvals-panel" aria-labelledby="approvalsHeading">
            <div class="section-head">
              <h3 id="approvalsHeading">Approvals</h3>
              <button id="toggleApprovalsButton" class="ghost" type="button" aria-expanded="false" aria-controls="approvalTray">
                Show
              </button>
            </div>
            <div id="approvalGlobalSummary" class="approval-summary-line" hidden></div>
            <div id="approvalTray" class="approval-tray" hidden></div>
          </section>

          <section class="panel transcript-panel" aria-label="Transcript">
            <div id="messageList" class="messages" aria-live="polite"></div>
          </section>

          <form id="composerForm" class="composer panel" aria-label="Send instruction">
            <label for="composerInput" class="sr-only">Message</label>
            <textarea id="composerInput" placeholder="Send instruction to Codex Chat" rows="3"></textarea>
            <button type="submit" class="primary">Send</button>
          </form>
        </section>
      </section>
    </main>

    <section id="projectSheet" class="sheet" role="dialog" aria-modal="true" aria-labelledby="projectSheetTitle" hidden>
      <div class="sheet-backdrop" data-close-sheet="project"></div>
      <div class="sheet-card" tabindex="-1">
        <div class="sheet-head">
          <h2 id="projectSheetTitle">All projects</h2>
          <button id="closeProjectSheetButton" class="ghost" type="button" aria-label="Close project list">Close</button>
        </div>
        <ul id="projectSheetList" class="sheet-list" aria-label="All projects"></ul>
      </div>
    </section>

    <section id="accountSheet" class="sheet" role="dialog" aria-modal="true" aria-labelledby="accountSheetTitle" hidden>
      <div class="sheet-backdrop" data-close-sheet="account"></div>
      <div class="sheet-card" tabindex="-1">
        <div class="sheet-head">
          <h2 id="accountSheetTitle">Connection</h2>
          <button id="closeAccountSheetButton" class="ghost" type="button" aria-label="Close account and connection controls">Close</button>
        </div>

        <p id="pairingHint" class="pairing-hint">Open via desktop QR link to auto-fill session details.</p>

        <dl class="kv">
          <dt>Session</dt>
          <dd id="sessionValue">Not paired</dd>
          <dt>Last seq</dt>
          <dd id="seqValue">-</dd>
          <dt>Last synced</dt>
          <dd id="lastSyncedValue">Never</dd>
        </dl>

        <div class="actions">
          <button id="pairButton" class="primary" type="button">Pair Device</button>
          <button id="reconnectButton" type="button">Reconnect</button>
          <button id="snapshotButton" type="button">Request Snapshot</button>
          <button id="forgetButton" type="button" hidden>Forget This Device</button>
        </div>

        <p id="statusText" class="status">Waiting to pair.</p>
      </div>
    </section>

    <script type="module" src="./app.js?v=20260228a"></script>
  </body>
</html>
